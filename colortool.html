<!doctype html>
<html>
  <head>
    <title>Color Analysis Tool</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style.css" type="text/css">
	<script src="jquery-2.2.4.js" type="text/javascript"></script>
	<script src="sylvester.js" type="text/javascript"></script>
    <script src="glUtils.js" type="text/javascript"></script>
   	<script type="text/javascript" src="lib/diff.js"></script>
	<script type="text/javascript" src="lib/convert.js"></script>
	<script type="text/javascript" src="lib/convert_extend.js"></script>
	
	<!--shader with texture of 2d values and 1d lookup table-->
    <script id="img-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec2 aVertexTexCoord;

		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec2 vTexCoord;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vTexCoord = aVertexTexCoord;
		}
    </script>

    <script id="img-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec2 vTexCoord;
		
		uniform sampler2D uTexVal;
		uniform sampler2D uColormap;
		
		/*const vec4 bitDec = 1./vec4(1.,256.,65536.,16777216.); 
		
		float DecodeFloatRGBA (vec4 v) {
			return dot(v, bitDec);
		}
		*/
		
		const vec3 bitDec = 1./vec3(1.,256.,65536.);
		
		float DecodeFloatRGBA (vec3 v) {
			return dot(v, bitDec);
		}
		
		void main(void) {
			if(val.a==0){
				gl_FragColor=vec4(0.5,0.5,0.5,1);
			}
			else{
				vec4 val = texture2D(uTexVal, vTexCoord);
				float unpack = DecodeFloatRGBA(val.rgb);
				gl_FragColor = vec4(texture2D(uColormap, vec2(unpack,0)).rgb,1);
			}
		}
    </script>


	<!--shader with 1d texture-->
    <script id="colormap-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec2 aVertexTexCoord;

		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec2 vTexCoord;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vTexCoord = aVertexTexCoord;
		}
    </script>

    <script id="colormap-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec2 vTexCoord;
		
		uniform sampler2D uColormap;
		
		void main(void) {
			gl_FragColor = texture2D(uColormap, vTexCoord);
		}
    </script>
	
	<!--simple shader-->
	    <script id="simple-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec4 aVertexColor;
		
		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec4 vColor;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vColor=aVertexColor;
		}
    </script>
	

    <script id="simple-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec4 vColor;
		
		void main(void) {
			gl_FragColor = vColor;
		}
    </script>
    
  </head>

  <body onload="start()">
	
	<div class="image" id="img1">
		<canvas id="glcanvas" width="1200" height="700" class="webgl">
		  <!--Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element. -->
		</canvas>
		<canvas id="text" width="1200" height="700" class="webgl">text canvas</canvas>
		
	</div>
	
	
	<DIV id="status"></DIV>
	
	<DIV class=drop id="drop1">
		
	</DIV>
	
	<input type="file" id="selector1" multiple="multiple" >
	
	<DIV class=drop id="drop2">
		
	</DIV>
	
	<input type="file" id="selector2" multiple="multiple" >
	
  </body>
  <canvas id="imageCanvas"></canvas>
  <script src="main.js" type="text/javascript"></script>
</html>