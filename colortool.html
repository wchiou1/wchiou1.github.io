<!doctype html>
<html>
  <head>
  <?php
		//$dir    = '/data/colorscale';
		//$files1 = scandir($dir);
		//$files2 = scandir($dir, 1);
		
		echo "Chickens";
		print "Chickens";
		//print_r("chicken");
		//print_r($files1);
		//print_r($files2);
	?>
    <title>Color Analysis Tool</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style.css" type="text/css">
	<script src="jquery-2.2.4.js" type="text/javascript"></script>
	<script src="sylvester.js" type="text/javascript"></script>
    <script src="glUtils.js" type="text/javascript"></script>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
   	<script type="text/javascript" src="lib/diff.js"></script>
	<script type="text/javascript" src="lib/convert.js"></script>
	<script type="text/javascript" src="lib/convert_extend.js"></script>
	
	<!--shader with texture of 2d values and 1d lookup table-->
    <script id="img-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec2 aVertexTexCoord;

		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec2 vTexCoord;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vTexCoord = aVertexTexCoord;
		}
    </script>

    <script id="img-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec2 vTexCoord;
		
		uniform sampler2D uTexVal;
		uniform sampler2D uColormap;
		uniform float uInverted; //1.0=true 0.0=false
		
		/*const vec4 bitDec = 1./vec4(1.,256.,65536.,16777216.); 
		
		float DecodeFloatRGBA (vec4 v) {
			return dot(v, bitDec);
		}
		*/
		
		const vec3 bitDec = 1./vec3(1.,256.,65536.);
		
		float DecodeFloatRGBA (vec3 v) {
			return dot(v, bitDec);
		}
		
		void main(void) {
			vec4 val = texture2D(uTexVal, vTexCoord);
			if(val.a==0.0){
				discard;
			}

			float unpack = abs(uInverted-DecodeFloatRGBA(val.rgb));
			
			gl_FragColor = vec4(texture2D(uColormap, vec2(unpack,0)).rgb,1);
			
		}
    </script>


	<!--shader with 1d texture-->
    <script id="colormap-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec2 aVertexTexCoord;

		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec2 vTexCoord;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vTexCoord = aVertexTexCoord;
		}
    </script>

    <script id="colormap-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec2 vTexCoord;
		
		uniform sampler2D uColormap;
		
		void main(void) {
			gl_FragColor = texture2D(uColormap, vTexCoord);
		}
    </script>
	
	
	<!--simple shader-->
	    <script id="simple-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec4 aVertexColor;
		
		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		
		varying vec4 vColor;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			gl_PointSize=5.0;
			vColor=aVertexColor;
		}
    </script>
	

    <script id="simple-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		varying vec4 vColor;
		
		void main(void) {
			gl_FragColor = vColor;
		}
    </script>
	
	    <!-- 3D Tube shader program -->

	<script id="tube-shader-vs" type="x-shader/x-vertex">
		attribute vec3 aVertexPosition;
		attribute vec3 aVertexNormal;
		attribute float aVertexWeight;
		
		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		uniform float uInverted; //1.0=true 0.0=false
		
		varying float vWeight;
		varying vec3 vNormal;

		void main(void) {
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vNormal = normalize(mat3(uMVMatrix)*aVertexNormal);
			vWeight=abs(uInverted-aVertexWeight);
		}
    </script>

    <script id="tube-shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		
		const float ambient = 0.1;
		const vec3 lightDir =vec3(0.0,0.0,1.0);
		varying float vWeight;
		varying vec3 vNormal;
		
		uniform sampler2D uColormap;
		
		void main(void) {
		
			float lightWeight=clamp(dot(vNormal,lightDir)+ambient,ambient,1.0);
			gl_FragColor = vec4(   lightWeight * texture2D(uColormap, vec2(vWeight,0)).rgb	   ,1);
		}
    </script>
    

  </head>

  <body onload="start()">
	

	<div class="container" id="container1" >
		<canvas id="glcanvas"  class="webgl" >
			<!--Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element. -->
		</canvas>
		<canvas id="text" >	</canvas>
		<canvas id="imageCanvas"></canvas>
		<DIV class=drop id="drop1">  </DIV>
		<DIV class=drop id="drop2">	</DIV>
		<input type="file" id="selector1" multiple="multiple" >
		<input type="file" id="selector2" multiple="multiple" >
		<input type="file" id="selector3" multiple="multiple" >
		<div class=button id="button1">Load image</div>
		<div class=button id="button2">Load colormap</div>
		<div class=button id="button3">Load svl</div>
		<div class=button id="button4">Reset view</div>
		<div class=button id="button5">Show LabGraph</div>
		<img class="fadeButton" src="icon/cam.png" id="screenshot1">
		<img class="fadeButton" src="icon/cam.png" id="screenshot2">
		<img class="fadeButton" src="icon/invert1.png" id="invert1">
		<img class="fadeButton" src="icon/invert1.png" id="invert2">
		<div class="loader" id="load"></div>
		
		<div id="lab">
			<div class='fadeButton' id='hideLab'>hide</div>
			<canvas id="glcanvas2" width="320" height="640" class="webgl">	</canvas>
		</div>
		
	</div>	

	
	<DIV id="status"></DIV>
	
	
	<!-- Trigger the modal with a button -->
	<div id="button6" type="button" class=button data-toggle="modal" data-target="#myModal">Open Modal</div>

	<!-- Modal -->
	<div id="myModal" class="modal fade" role="dialog">
	  <div class="modal-dialog modal-lg">

		<!-- Modal content-->
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" >&times;</button>
			<h4 class="modal-title">Adding color maps</h4>
		  </div>
		  <div class="modal-body">
			<form  method="POST" name="theForm">
			<table bgcolor="white" border="1" cellpadding="1" cellspacing="2" align="center">
			<tr>
				<th>Serverside files</th>
				<th>To be loaded</th>
				<th>Currently loaded</th>
			</tr>
			<tr><td align="center">
				<select id=select1 name=menu1 size=10 multiple>
				   <option>Menu Item 1</option>
				   <option>Massive Giant Chickens</option>
				   <option>Menu Item 3</option>
				   <option>Menu Item 4</option>
				   <option>Menu Item 5</option>
				   <option>Menu Item 1</option>
				   <option>Massive Giant Chickens</option>
				   <option>Menu Item 3</option>
				   <option>Menu Item 4</option>
				   <option>Menu Item 5</option>
				   <option>Menu Item 1</option>
				   <option>Massive Giant Chickens</option>
				   <option>Menu Item 3</option>
				   <option>Menu Item 4</option>
				   <option>Menu Item 5</option>
				</select><br />
				<p align="center"><input type="button" onClick="one2two()" value=" >> "></p>

			</td><td align="center">

				<select id=select2 name=menu2 size=10 multiple >
				<option>Menu Item 6</option>
				</select><br />
				<p align="center"><input type="button" onClick="two2one()" value=" << " ></p>

			</td><td align="center">
				<select id=select3 name=menu3 size=10 multiple>
				   <option>Chickens</option>
				</select><br />
			</td></tr></table>
			</form>
		  </div>
		  <div class="modal-footer">
			<button id="coloradd" type="button" class="btn btn-default" data-dismiss="modal" onClick="addColors()">Add Colors</button>
		  </div>
		</div>
	  </div>
	</div>
  </body>
  
  <script src="main.js" type="text/javascript"></script>
  <script src="colorform.js" type="text/javascript"></script>
</html>